CREATE TABLE STATS (
                       STAT_ID INT(11) AUTO_INCREMENT PRIMARY KEY,
                       STAT_DATE DATETIME NOT NULL,
                       STAT VARCHAR(20) NOT NULL,
                       VALUE INT(11) NOT NULL
);

CREATE VIEW BESTSELLERS_COUNT AS
SELECT BESTSELLER, COUNT(*) AS BESTSELLER_NUMBER
FROM BOOKS
WHERE BESTSELLER = TRUE;

SELECT * FROM BESTSELLERS_COUNT;
SELECT * FROM BOOKS;

USE KODILLA_COURSE;
DELIMITER $$
CREATE EVENT UPDATE_BESTSELLERS
    ON SCHEDULE EVERY 1 MINUTE
    DO
    BEGIN
        DECLARE BESTSELLER_NO INT;
        CALL UpdateBestsellers();
        SELECT BESTSELLER_NUMBER FROM BESTSELLERS_COUNT INTO BESTSELLER_NO;
        INSERT INTO STATS (STAT_DATE, STAT, VALUE) VALUES (CURTIME(), 'BESTSELLER NUMBER', BESTSELLER_NO);
    END $$
DELIMITER ;


INSERT INTO RENTS(BOOK_ID, READER_ID, RENT_DATE, RETURN_DATE)   -- test
VALUES (1, 2, DATE_SUB(CURDATE(), INTERVAL 10 DAY), null);
COMMIT;
INSERT INTO RENTS(BOOK_ID, READER_ID, RENT_DATE, RETURN_DATE)
VALUES (1, 4, DATE_SUB(CURDATE(), INTERVAL 10 DAY), null);
COMMIT;
INSERT INTO RENTS(BOOK_ID, READER_ID, RENT_DATE, RETURN_DATE)
VALUES (1, 5, DATE_SUB(CURDATE(), INTERVAL 10 DAY), null);
COMMIT;

SELECT * FROM STATS;